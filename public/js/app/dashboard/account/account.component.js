"use strict";var __decorate=this&&this.__decorate||function(e,t,r,c){var o,i=arguments.length,n=i<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,c);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(n=(i<3?o(n):i>3?o(t,r,n):o(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},core_1=require("@angular/core"),router_1=require("@angular/router"),moment=require("moment"),auth_service_1=require("../../shared/services/auth.service"),service_package_service_1=require("../../shared/services/service.package.service"),socket_service_1=require("../../shared/services/socket.service"),AccountComponent=function(){function e(e,t,r,c){this.router=e,this.authService=t,this.socket=r,this.servicePackage=c,this.service="student"}return e.prototype.generateTime=function(e){return moment(e).format("LLL")},e.prototype.generateDate=function(e){return moment(e).format("LL")},e.prototype.getCurrentUser=function(){var e=this;this.authService.getCurrentUser(JSON.parse(localStorage.getItem("current_user"))._id).subscribe(function(t){console.log(t),e.currentUser=t},function(t){e.authService.logUserOut(),console.log(t)})},e.prototype.onSubmit=function(e,t){function r(e){c[t]=!c[t]}var c=this;this.authService.updateUser(e).subscribe(function(e){return r(e)},function(e){return console.log("err @updateUser: ",e)})},e.prototype.edit=function(e){this[e]=!this[e]},e.prototype.checkRole=function(e,t){return!!t&&this.authService.checkAuthority(e,t.role)},e.prototype.resetErr=function(e){this.roleNotMatchService=!1,this.emailError=!1},e.prototype.addService=function(e,t){var r=this;if(e){var c={currentUser:this.currentUser,userToAdd:{}};this.authService.getUserByEmail(e).subscribe(function(e){e.role===t?(c.userToAdd=e,r.servicePackage.createService(c).subscribe(function(e){console.log("service created")},function(e){console.log(e)})):r.roleNotMatchService=!0},function(e){r.emailError=!0})}},e.prototype.ngOnInit=function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("current_user")),this.getCurrentUser(),this.socket.syncById("user",this.currentUser._id,function(t){e.currentUser=t})},e.prototype.ngOnDestroy=function(){this.socket.unsyncById("user",this.currentUser._id,function(){})},e=__decorate([core_1.Component({moduleId:module.id,selector:"yeah-account",templateUrl:"account.component.html",styleUrls:["account.style.css"],providers:[auth_service_1.AuthService,socket_service_1.SocketService,service_package_service_1.ServicePackageService]}),__metadata("design:paramtypes",[router_1.Router,auth_service_1.AuthService,socket_service_1.SocketService,service_package_service_1.ServicePackageService])],e)}();exports.AccountComponent=AccountComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhc2hib2FyZC9hY2NvdW50L2FjY291bnQuY29tcG9uZW50LmpzIiwiZGFzaGJvYXJkL2FjY291bnQvYWNjb3VudC5jb21wb25lbnQudHMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsInRoaXMiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImQiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fbWV0YWRhdGEiLCJrIiwidiIsIm1ldGFkYXRhIiwiY29yZV8xIiwicmVxdWlyZSIsInJvdXRlcl8xIiwibW9tZW50IiwiYXV0aF9zZXJ2aWNlXzEiLCJzZXJ2aWNlX3BhY2thZ2Vfc2VydmljZV8xIiwic29ja2V0X3NlcnZpY2VfMSIsIkFjY291bnRDb21wb25lbnQiLCJyb3V0ZXIiLCJhdXRoU2VydmljZSIsInNvY2tldCIsInNlcnZpY2VQYWNrYWdlIiwic2VydmljZSIsInByb3RvdHlwZSIsImdlbmVyYXRlVGltZSIsInVuaXgiLCJmb3JtYXQiLCJnZW5lcmF0ZURhdGUiLCJnZXRDdXJyZW50VXNlciIsIl90aGlzIiwiSlNPTiIsInBhcnNlIiwibG9jYWxTdG9yYWdlIiwiZ2V0SXRlbSIsIl9pZCIsInN1YnNjcmliZSIsInVzZXIiLCJjb25zb2xlIiwibG9nIiwiY3VycmVudFVzZXIiLCJlcnJvciIsImxvZ1VzZXJPdXQiLCJvblN1Ym1pdCIsInZhbHVlIiwiY2FyZE5hbWUiLCJoYW5kbGVSZXNwb25zZSIsInJlcyIsInNlbGYiLCJ1cGRhdGVVc2VyIiwiZXJyIiwiZWRpdCIsImNoZWNrUm9sZSIsInJvbGUiLCJjaGVja0F1dGhvcml0eSIsInJlc2V0RXJyIiwiZXZlbnQiLCJyb2xlTm90TWF0Y2hTZXJ2aWNlIiwiZW1haWxFcnJvciIsImFkZFNlcnZpY2UiLCJlbWFpbCIsImRhdGFfMSIsInVzZXJUb0FkZCIsImdldFVzZXJCeUVtYWlsIiwiY3JlYXRlU2VydmljZSIsIm5nT25Jbml0Iiwic3luY0J5SWQiLCJuZ09uRGVzdHJveSIsInVuc3luY0J5SWQiLCJDb21wb25lbnQiLCJtb2R1bGVJZCIsIm1vZHVsZSIsImlkIiwic2VsZWN0b3IiLCJ0ZW1wbGF0ZVVybCIsInN0eWxlVXJscyIsInByb3ZpZGVycyIsIkF1dGhTZXJ2aWNlIiwiU29ja2V0U2VydmljZSIsIlNlcnZpY2VQYWNrYWdlU2VydmljZSIsIlJvdXRlciIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQ0EsSUFBSUEsWUFBY0MsTUFBUUEsS0FBS0QsWUFBZSxTQUFVRSxFQUFZQyxFQUFRQyxFQUFLQyxHQUM3RSxHQUEySEMsR0FBdkhDLEVBQUlDLFVBQVVDLE9BQVFDLEVBQUlILEVBQUksRUFBSUosRUFBa0IsT0FBVEUsRUFBZ0JBLEVBQU9NLE9BQU9DLHlCQUF5QlQsRUFBUUMsR0FBT0MsQ0FDckgsSUFBdUIsZ0JBQVpRLFVBQW9ELGtCQUFyQkEsU0FBUUMsU0FBeUJKLEVBQUlHLFFBQVFDLFNBQVNaLEVBQVlDLEVBQVFDLEVBQUtDLE9BQ3BILEtBQUssR0FBSVUsR0FBSWIsRUFBV08sT0FBUyxFQUFHTSxHQUFLLEVBQUdBLEtBQVNULEVBQUlKLEVBQVdhLE1BQUlMLEdBQUtILEVBQUksRUFBSUQsRUFBRUksR0FBS0gsRUFBSSxFQUFJRCxFQUFFSCxFQUFRQyxFQUFLTSxHQUFLSixFQUFFSCxFQUFRQyxLQUFTTSxFQUNoSixPQUFPSCxHQUFJLEdBQUtHLEdBQUtDLE9BQU9LLGVBQWViLEVBQVFDLEVBQUtNLEdBQUlBLEdBRTVETyxXQUFjaEIsTUFBUUEsS0FBS2dCLFlBQWUsU0FBVUMsRUFBR0MsR0FDdkQsR0FBdUIsZ0JBQVpOLFVBQW9ELGtCQUFyQkEsU0FBUU8sU0FBeUIsTUFBT1AsU0FBUU8sU0FBU0YsRUFBR0MsSUNSMUdFLE9BQUFDLFFBQTZDLGlCQUM3Q0MsU0FBQUQsUUFBMEIsbUJBQ25CRSxPQUFNRixR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L0QsaUJBQWdCQSIsImZpbGUiOiJkYXNoYm9hcmQvYWNjb3VudC9hY2NvdW50LmNvbXBvbmVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xudmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xudmFyIF9fbWV0YWRhdGEgPSAodGhpcyAmJiB0aGlzLl9fbWV0YWRhdGEpIHx8IGZ1bmN0aW9uIChrLCB2KSB7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0Lm1ldGFkYXRhID09PSBcImZ1bmN0aW9uXCIpIHJldHVybiBSZWZsZWN0Lm1ldGFkYXRhKGssIHYpO1xufTtcbnZhciBjb3JlXzEgPSByZXF1aXJlKCdAYW5ndWxhci9jb3JlJyk7XG52YXIgcm91dGVyXzEgPSByZXF1aXJlKCdAYW5ndWxhci9yb3V0ZXInKTtcbnZhciBtb21lbnQgPSByZXF1aXJlKCdtb21lbnQnKTtcbnZhciBhdXRoX3NlcnZpY2VfMSA9IHJlcXVpcmUoJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9hdXRoLnNlcnZpY2UnKTtcbnZhciBzZXJ2aWNlX3BhY2thZ2Vfc2VydmljZV8xID0gcmVxdWlyZSgnLi4vLi4vc2hhcmVkL3NlcnZpY2VzL3NlcnZpY2UucGFja2FnZS5zZXJ2aWNlJyk7XG52YXIgc29ja2V0X3NlcnZpY2VfMSA9IHJlcXVpcmUoJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9zb2NrZXQuc2VydmljZScpO1xudmFyIEFjY291bnRDb21wb25lbnQgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFjY291bnRDb21wb25lbnQocm91dGVyLCBhdXRoU2VydmljZSwgc29ja2V0LCBzZXJ2aWNlUGFja2FnZSkge1xuICAgICAgICB0aGlzLnJvdXRlciA9IHJvdXRlcjtcbiAgICAgICAgdGhpcy5hdXRoU2VydmljZSA9IGF1dGhTZXJ2aWNlO1xuICAgICAgICB0aGlzLnNvY2tldCA9IHNvY2tldDtcbiAgICAgICAgdGhpcy5zZXJ2aWNlUGFja2FnZSA9IHNlcnZpY2VQYWNrYWdlO1xuICAgICAgICB0aGlzLnNlcnZpY2UgPSAnc3R1ZGVudCc7XG4gICAgfVxuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmdlbmVyYXRlVGltZSA9IGZ1bmN0aW9uICh1bml4KSB7XG4gICAgICAgIHJldHVybiBtb21lbnQodW5peCkuZm9ybWF0KCdMTEwnKTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmdlbmVyYXRlRGF0ZSA9IGZ1bmN0aW9uICh1bml4KSB7XG4gICAgICAgIHJldHVybiBtb21lbnQodW5peCkuZm9ybWF0KCdMTCcpO1xuICAgIH07XG4gICAgQWNjb3VudENvbXBvbmVudC5wcm90b3R5cGUuZ2V0Q3VycmVudFVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF91c2VyJykpLl9pZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHVzZXIpO1xuICAgICAgICAgICAgX3RoaXMuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIF90aGlzLmF1dGhTZXJ2aWNlLmxvZ1VzZXJPdXQoKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5vblN1Ym1pdCA9IGZ1bmN0aW9uICh2YWx1ZSwgY2FyZE5hbWUpIHtcbiAgICAgICAgLy8gU2VuZCB1cGRhdGVkIHVzZXIgb2JqZWN0IHRvIGJhY2tlbmRcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLnVwZGF0ZVVzZXIodmFsdWUpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGZ1bmN0aW9uIChyZXMpIHsgcmV0dXJuIGhhbmRsZVJlc3BvbnNlKHJlcyk7IH0sIGZ1bmN0aW9uIChlcnIpIHsgcmV0dXJuIGNvbnNvbGUubG9nKCdlcnIgQHVwZGF0ZVVzZXI6ICcsIGVycik7IH0pO1xuICAgICAgICBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICAgICAgICAgIC8vIEFmdGVyIHNhdmluZyBzdWNjZXNzZnVsbHkgQ2xvc2UgdGhlIHNwZWNpZmljIGNhcmQoZm9ybSlcbiAgICAgICAgICAgIHNlbGZbY2FyZE5hbWVdID0gIShzZWxmW2NhcmROYW1lXSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmVkaXQgPSBmdW5jdGlvbiAoY2FyZE5hbWUpIHtcbiAgICAgICAgdGhpc1tjYXJkTmFtZV0gPSAhKHRoaXNbY2FyZE5hbWVdKTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmNoZWNrUm9sZSA9IGZ1bmN0aW9uIChyb2xlLCB1c2VyKSB7XG4gICAgICAgIC8vcm9sZSBpcyB0aGUgcmVxdWlyZWQgcm9sZSB0byBhY2Nlc3MgdGhlIGNvbnRlbnRcbiAgICAgICAgLy9Vc2VyJ3Mgcm9sZSBtdXN0IGhhdmUgaGlnaGVyIG9yIGVxdWFsIGF1dGhvcml0eSB0byB0aGlzIHJvbGVcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KHJvbGUsIHVzZXIucm9sZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLnJlc2V0RXJyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMucm9sZU5vdE1hdGNoU2VydmljZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVtYWlsRXJyb3IgPSBmYWxzZTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmFkZFNlcnZpY2UgPSBmdW5jdGlvbiAoZW1haWwsIHNlcnZpY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGVtYWlsKSB7XG4gICAgICAgICAgICB2YXIgZGF0YV8xID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyOiB0aGlzLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgICAgIHVzZXJUb0FkZDoge31cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvL0ZpbmQgdXNlciBieSBlbWFpbFxuICAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZS5nZXRVc2VyQnlFbWFpbChlbWFpbClcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgLy9DaGVjayBpZiB0aGlzIHVzZXIgaGFzIHRoZSByb2xlIGZvciB0aGUgaW50ZW5kZWQgc2VydmljZVxuICAgICAgICAgICAgICAgIGlmICh1c2VyLnJvbGUgPT09IHNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YV8xLnVzZXJUb0FkZCA9IHVzZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vQWRkIHVzZXIgdG8gdGhpcyB1c2VyJ3Mgc2VydmljZVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXJ2aWNlUGFja2FnZS5jcmVhdGVTZXJ2aWNlKGRhdGFfMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIGNyZWF0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgX3RoaXMucm9sZU5vdE1hdGNoU2VydmljZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgX3RoaXMuZW1haWxFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQWNjb3VudENvbXBvbmVudC5wcm90b3R5cGUubmdPbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdXNlcicpKTtcbiAgICAgICAgdGhpcy5nZXRDdXJyZW50VXNlcigpO1xuICAgICAgICB0aGlzLnNvY2tldC5zeW5jQnlJZCgndXNlcicsIHRoaXMuY3VycmVudFVzZXIuX2lkLCBmdW5jdGlvbiAodXNlcikge1xuICAgICAgICAgICAgc2VsZi5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQWNjb3VudENvbXBvbmVudC5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc29ja2V0LnVuc3luY0J5SWQoJ3VzZXInLCB0aGlzLmN1cnJlbnRVc2VyLl9pZCwgZnVuY3Rpb24gKCkge1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZV8xLkNvbXBvbmVudCh7XG4gICAgICAgICAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgICAgICAgICAgc2VsZWN0b3I6ICd5ZWFoLWFjY291bnQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhY2NvdW50LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgICAgIHN0eWxlVXJsczogWydhY2NvdW50LnN0eWxlLmNzcyddLFxuICAgICAgICAgICAgcHJvdmlkZXJzOiBbYXV0aF9zZXJ2aWNlXzEuQXV0aFNlcnZpY2UsIHNvY2tldF9zZXJ2aWNlXzEuU29ja2V0U2VydmljZSwgc2VydmljZV9wYWNrYWdlX3NlcnZpY2VfMS5TZXJ2aWNlUGFja2FnZVNlcnZpY2VdXG4gICAgICAgIH0pLCBcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbcm91dGVyXzEuUm91dGVyLCBhdXRoX3NlcnZpY2VfMS5BdXRoU2VydmljZSwgc29ja2V0X3NlcnZpY2VfMS5Tb2NrZXRTZXJ2aWNlLCBzZXJ2aWNlX3BhY2thZ2Vfc2VydmljZV8xLlNlcnZpY2VQYWNrYWdlU2VydmljZV0pXG4gICAgXSwgQWNjb3VudENvbXBvbmVudCk7XG4gICAgcmV0dXJuIEFjY291bnRDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0cy5BY2NvdW50Q29tcG9uZW50ID0gQWNjb3VudENvbXBvbmVudDtcbiIsImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9ICAgIGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5cbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi8uLi9zaGFyZWQvdHlwZXMvdXNlcidcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBTZXJ2aWNlUGFja2FnZVNlcnZpY2UgfSBmcm9tICcuLi8uLi9zaGFyZWQvc2VydmljZXMvc2VydmljZS5wYWNrYWdlLnNlcnZpY2UnO1xuaW1wb3J0IHsgU29ja2V0U2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9zb2NrZXQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICd5ZWFoLWFjY291bnQnLFxuICAgIHRlbXBsYXRlVXJsOiAnYWNjb3VudC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJ2FjY291bnQuc3R5bGUuY3NzJ10sXG4gICAgcHJvdmlkZXJzOiBbQXV0aFNlcnZpY2UsIFNvY2tldFNlcnZpY2UsIFNlcnZpY2VQYWNrYWdlU2VydmljZV1cbn0pXG5cbmV4cG9ydCBjbGFzcyBBY2NvdW50Q29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3kge1xuICAgIGN1cnJlbnRVc2VyOiBVc2VyO1xuICAgIGVkaXRBSTogYm9vbGVhbjtcbiAgICBlZGl0R0k6IGJvb2xlYW47XG4gICAgZW1haWxFcnJvcjogYm9vbGVhbjtcbiAgICByb2xlTm90TWF0Y2hTZXJ2aWNlOiBib29sZWFuO1xuICAgIHNlcnZpY2UgPSAnc3R1ZGVudCc7XG5cbiAgICBjb25zdHJ1Y3RvcihcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBhdXRoU2VydmljZTogQXV0aFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgc29ja2V0OiBTb2NrZXRTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHNlcnZpY2VQYWNrYWdlOiBTZXJ2aWNlUGFja2FnZVNlcnZpY2VcbiAgICApIHsgfVxuXG4gICAgZ2VuZXJhdGVUaW1lKHVuaXgpIHtcbiAgICAgICAgcmV0dXJuIG1vbWVudCh1bml4KS5mb3JtYXQoJ0xMTCcpO1xuICAgIH1cblxuICAgIGdlbmVyYXRlRGF0ZSh1bml4KSB7XG4gICAgICAgIHJldHVybiBtb21lbnQodW5peCkuZm9ybWF0KCdMTCcpO1xuICAgIH1cblxuICAgIGdldEN1cnJlbnRVc2VyKCkge1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdXNlcicpKS5faWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgdXNlciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coPGFueT5lcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBvblN1Ym1pdCh2YWx1ZTogYW55LCBjYXJkTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIC8vIFNlbmQgdXBkYXRlZCB1c2VyIG9iamVjdCB0byBiYWNrZW5kXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2UudXBkYXRlVXNlcih2YWx1ZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgcmVzID0+IGhhbmRsZVJlc3BvbnNlKHJlcyksXG4gICAgICAgICAgICAgICAgZXJyID0+IGNvbnNvbGUubG9nKCdlcnIgQHVwZGF0ZVVzZXI6ICcsIGVycilcbiAgICAgICAgICAgIClcblxuICAgICAgICBmdW5jdGlvbiBoYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICAgICAgICAgIC8vIEFmdGVyIHNhdmluZyBzdWNjZXNzZnVsbHkgQ2xvc2UgdGhlIHNwZWNpZmljIGNhcmQoZm9ybSlcbiAgICAgICAgICAgIHNlbGZbY2FyZE5hbWVdID0gIShzZWxmW2NhcmROYW1lXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBlZGl0KGNhcmROYW1lOiBzdHJpbmcpIHtcbiAgICAgICAgdGhpc1tjYXJkTmFtZV0gPSAhKHRoaXNbY2FyZE5hbWVdKTtcbiAgICB9XG5cbiAgICBjaGVja1JvbGUocm9sZTogc3RyaW5nLCB1c2VyOiBVc2VyKSB7XG4gICAgICAgIC8vcm9sZSBpcyB0aGUgcmVxdWlyZWQgcm9sZSB0byBhY2Nlc3MgdGhlIGNvbnRlbnRcbiAgICAgICAgLy9Vc2VyJ3Mgcm9sZSBtdXN0IGhhdmUgaGlnaGVyIG9yIGVxdWFsIGF1dGhvcml0eSB0byB0aGlzIHJvbGVcbiAgICAgICAgaWYodXNlcikge1xuICAgICAgICAgICAgcmV0dXJuIHRoaXMuYXV0aFNlcnZpY2UuY2hlY2tBdXRob3JpdHkocm9sZSwgdXNlci5yb2xlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlc2V0RXJyKGV2ZW50OiBhbnkpIHtcbiAgICAgICAgdGhpcy5yb2xlTm90TWF0Y2hTZXJ2aWNlID0gZmFsc2U7XG4gICAgICAgIHRoaXMuZW1haWxFcnJvciA9IGZhbHNlO1xuICAgIH1cblxuICAgIGFkZFNlcnZpY2UoZW1haWw6IHN0cmluZywgc2VydmljZTpzdHJpbmcpIHtcbiAgICAgICAgaWYoZW1haWwpIHtcbiAgICAgICAgICAgIGxldCBkYXRhID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyOiB0aGlzLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgICAgIHVzZXJUb0FkZDoge31cbiAgICAgICAgICAgIH07XG5cbiAgICAgICAgICAgIC8vRmluZCB1c2VyIGJ5IGVtYWlsXG4gICAgICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldFVzZXJCeUVtYWlsKGVtYWlsKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgIHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgdGhpcyB1c2VyIGhhcyB0aGUgcm9sZSBmb3IgdGhlIGludGVuZGVkIHNlcnZpY2VcbiAgICAgICAgICAgICAgICBpZih1c2VyLnJvbGUgPT09IHNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VyVG9BZGQgPSB1c2VyO1xuICAgICAgICAgICAgICAgICAgICAvL0FkZCB1c2VyIHRvIHRoaXMgdXNlcidzIHNlcnZpY2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlUGFja2FnZS5jcmVhdGVTZXJ2aWNlKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2UgY3JlYXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMucm9sZU5vdE1hdGNoU2VydmljZSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZW1haWxFcnJvciA9IHRydWU7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3VzZXInKSk7XG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudFVzZXIoKTtcbiAgICAgICAgdGhpcy5zb2NrZXQuc3luY0J5SWQoJ3VzZXInLCB0aGlzLmN1cnJlbnRVc2VyLl9pZCwgZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgc2VsZi5jdXJyZW50VXNlciA9IHVzZXI7XG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zb2NrZXQudW5zeW5jQnlJZCgndXNlcicsIHRoaXMuY3VycmVudFVzZXIuX2lkLCBmdW5jdGlvbigpIHtcbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
