"use strict";var __decorate=this&&this.__decorate||function(e,t,r,c){var o,i=arguments.length,n=i<3?t:null===c?c=Object.getOwnPropertyDescriptor(t,r):c;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,c);else for(var s=e.length-1;s>=0;s--)(o=e[s])&&(n=(i<3?o(n):i>3?o(t,r,n):o(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},core_1=require("@angular/core"),router_1=require("@angular/router"),moment=require("moment"),auth_service_1=require("../../shared/services/auth.service"),service_service_1=require("../../shared/services/service.service"),socket_service_1=require("../../shared/services/socket.service"),AccountComponent=function(){function e(e,t,r,c){this.router=e,this.authService=t,this.socket=r,this.servicePackage=c,this.service="student"}return e.prototype.generateTime=function(e){return moment(e).format("LLL")},e.prototype.generateDate=function(e){return moment(e).format("LL")},e.prototype.getCurrentUser=function(){var e=this;this.authService.getCurrentUser(JSON.parse(localStorage.getItem("current_user"))._id).subscribe(function(t){console.log(t),e.currentUser=t},function(t){e.authService.logUserOut(),console.log(t)})},e.prototype.updateCurrentUser=function(e,t){function r(e){c[t]=!c[t]}var c=this;this.authService.updateCurrentUser(e).subscribe(function(e){return r(e)},function(e){return console.log("err @updateUser: ",e)})},e.prototype.edit=function(e){this[e]=!this[e],this.getCurrentUser()},e.prototype.checkRole=function(e,t){return!!t&&this.authService.checkAuthority(e,t.role)},e.prototype.resetErr=function(e){this.roleNotMatchService=!1,this.emailError=!1},e.prototype.addService=function(e,t){var r=this;if(e){var c={currentUser:this.currentUser,userToAdd:{}},o=this;this.sending=!0,this.authService.getUserByEmail(e).subscribe(function(e){e.role===t?(c.userToAdd=e,r.servicePackage.createService(c).subscribe(function(e){console.log("service created"),o.sending=!1},function(e){console.log(e)})):(o.roleNotMatchService=!0,o.sending=!1)},function(e){o.emailError=!0,o.sending=!1})}},e.prototype.ngOnInit=function(){var e=this;this.currentUser=JSON.parse(localStorage.getItem("current_user")),this.getCurrentUser(),this.socket.syncById("user",this.currentUser._id,function(t){e.currentUser=t})},e.prototype.ngOnDestroy=function(){this.socket.unsyncById("user",this.currentUser._id)},e=__decorate([core_1.Component({moduleId:module.id,selector:"yeah-account",templateUrl:"account.component.html",styleUrls:["account.style.css"],providers:[auth_service_1.AuthService,socket_service_1.SocketService,service_service_1.ServiceService]}),__metadata("design:paramtypes",[router_1.Router,auth_service_1.AuthService,socket_service_1.SocketService,service_service_1.ServiceService])],e)}();exports.AccountComponent=AccountComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhc2hib2FyZC9hY2NvdW50L2FjY291bnQuY29tcG9uZW50LmpzIiwiZGFzaGJvYXJkL2FjY291bnQvYWNjb3VudC5jb21wb25lbnQudHMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsInRoaXMiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImQiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fbWV0YWRhdGEiLCJrIiwidiIsIm1ldGFkYXRhIiwiY29yZV8xIiwicmVxdWlyZSIsInJvdXRlcl8xIiwibW9tZW50IiwiYXV0aF9zZXJ2aWNlXzEiLCJzZXJ2aWNlX3NlcnZpY2VfMSIsInNvY2tldF9zZXJ2aWNlXzEiLCJBY2NvdW50Q29tcG9uZW50Iiwicm91dGVyIiwiYXV0aFNlcnZpY2UiLCJzb2NrZXQiLCJzZXJ2aWNlUGFja2FnZSIsInNlcnZpY2UiLCJwcm90b3R5cGUiLCJnZW5lcmF0ZVRpbWUiLCJ1bml4IiwiZm9ybWF0IiwiZ2VuZXJhdGVEYXRlIiwiZ2V0Q3VycmVudFVzZXIiLCJfdGhpcyIsIkpTT04iLCJwYXJzZSIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJfaWQiLCJzdWJzY3JpYmUiLCJ1c2VyIiwiY29uc29sZSIsImxvZyIsImN1cnJlbnRVc2VyIiwiZXJyb3IiLCJsb2dVc2VyT3V0IiwidXBkYXRlQ3VycmVudFVzZXIiLCJ2YWx1ZSIsImNhcmROYW1lIiwiaGFuZGxlUmVzcG9uc2UiLCJyZXMiLCJzZWxmIiwiZXJyIiwiZWRpdCIsImNoZWNrUm9sZSIsInJvbGUiLCJjaGVja0F1dGhvcml0eSIsInJlc2V0RXJyIiwiZXZlbnQiLCJyb2xlTm90TWF0Y2hTZXJ2aWNlIiwiZW1haWxFcnJvciIsImFkZFNlcnZpY2UiLCJlbWFpbCIsImRhdGFfMSIsInVzZXJUb0FkZCIsInNlbGZfMSIsInNlbmRpbmciLCJnZXRVc2VyQnlFbWFpbCIsImNyZWF0ZVNlcnZpY2UiLCJuZ09uSW5pdCIsInN5bmNCeUlkIiwibmdPbkRlc3Ryb3kiLCJ1bnN5bmNCeUlkIiwiQ29tcG9uZW50IiwibW9kdWxlSWQiLCJtb2R1bGUiLCJpZCIsInNlbGVjdG9yIiwidGVtcGxhdGVVcmwiLCJzdHlsZVVybHMiLCJwcm92aWRlcnMiLCJBdXRoU2VydmljZSIsIlNvY2tldFNlcnZpY2UiLCJTZXJ2aWNlU2VydmljZSIsIlJvdXRlciIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQ0EsSUFBSUEsWUFBY0MsTUFBUUEsS0FBS0QsWUFBZSxTQUFVRSxFQUFZQyxFQUFRQyxFQUFLQyxHQUM3RSxHQUEySEMsR0FBdkhDLEVBQUlDLFVBQVVDLE9BQVFDLEVBQUlILEVBQUksRUFBSUosRUFBa0IsT0FBVEUsRUFBZ0JBLEVBQU9NLE9BQU9DLHlCQUF5QlQsRUFBUUMsR0FBT0MsQ0FDckgsSUFBdUIsZ0JBQVpRLFVBQW9ELGtCQUFyQkEsU0FBUUMsU0FBeUJKLEVBQUlHLFFBQVFDLFNBQVNaLEVBQVlDLEVBQVFDLEVBQUtDLE9BQ3BILEtBQUssR0FBSVUsR0FBSWIsRUFBV08sT0FBUyxFQUFHTSxHQUFLLEVBQUdBLEtBQVNULEVBQUlKLEVBQVdhLE1BQUlMLEdBQUtILEVBQUksRUFBSUQsRUFBRUksR0FBS0gsRUFBSSxFQUFJRCxFQUFFSCxFQUFRQyxFQUFLTSxHQUFLSixFQUFFSCxFQUFRQyxLQUFTTSxFQUNoSixPQUFPSCxHQUFJLEdBQUtHLEdBQUtDLE9BQU9LLGVBQWViLEVBQVFDLEVBQUtNLEdBQUlBLEdBRTVETyxXQUFjaEIsTUFBUUEsS0FBS2dCLFlBQWUsU0FBVUMsRUFBR0MsR0FDdkQsR0FBdUIsZ0JBQVpOLFVBQW9ELGtCQUFyQkEsU0FBUU8sU0FBeUIsTUFBT1AsU0FBUU8sU0FBU0YsRUFBR0MsSUNSMUdFLE9BQUFDLFFBQTZDLGlCQUM3Q0MsU0FBQUQsUUFBMEIsbUJBQ25CRSxPQUFNRixR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RDRHcEN6RSxXQUFXLHFCQUFzQk0sU0FBU29FLE9BQVFsRSxlQUFlK0QsWUFBYTdELGlCQUFpQjhELGNBQWUvRCxrQkFBa0JnRSxrQkFDakk5RCxLQzFHTWdFLFNBQUFoRSxpQkFBZ0JBIiwiZmlsZSI6ImRhc2hib2FyZC9hY2NvdW50L2FjY291bnQuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XG59O1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoJ0Bhbmd1bGFyL2NvcmUnKTtcbnZhciByb3V0ZXJfMSA9IHJlcXVpcmUoJ0Bhbmd1bGFyL3JvdXRlcicpO1xudmFyIG1vbWVudCA9IHJlcXVpcmUoJ21vbWVudCcpO1xudmFyIGF1dGhfc2VydmljZV8xID0gcmVxdWlyZSgnLi4vLi4vc2hhcmVkL3NlcnZpY2VzL2F1dGguc2VydmljZScpO1xudmFyIHNlcnZpY2Vfc2VydmljZV8xID0gcmVxdWlyZSgnLi4vLi4vc2hhcmVkL3NlcnZpY2VzL3NlcnZpY2Uuc2VydmljZScpO1xudmFyIHNvY2tldF9zZXJ2aWNlXzEgPSByZXF1aXJlKCcuLi8uLi9zaGFyZWQvc2VydmljZXMvc29ja2V0LnNlcnZpY2UnKTtcbnZhciBBY2NvdW50Q29tcG9uZW50ID0gKGZ1bmN0aW9uICgpIHtcbiAgICBmdW5jdGlvbiBBY2NvdW50Q29tcG9uZW50KHJvdXRlciwgYXV0aFNlcnZpY2UsIHNvY2tldCwgc2VydmljZVBhY2thZ2UpIHtcbiAgICAgICAgdGhpcy5yb3V0ZXIgPSByb3V0ZXI7XG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2UgPSBhdXRoU2VydmljZTtcbiAgICAgICAgdGhpcy5zb2NrZXQgPSBzb2NrZXQ7XG4gICAgICAgIHRoaXMuc2VydmljZVBhY2thZ2UgPSBzZXJ2aWNlUGFja2FnZTtcbiAgICAgICAgdGhpcy5zZXJ2aWNlID0gJ3N0dWRlbnQnO1xuICAgIH1cbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5nZW5lcmF0ZVRpbWUgPSBmdW5jdGlvbiAodW5peCkge1xuICAgICAgICByZXR1cm4gbW9tZW50KHVuaXgpLmZvcm1hdCgnTExMJyk7XG4gICAgfTtcbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5nZW5lcmF0ZURhdGUgPSBmdW5jdGlvbiAodW5peCkge1xuICAgICAgICByZXR1cm4gbW9tZW50KHVuaXgpLmZvcm1hdCgnTEwnKTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmdldEN1cnJlbnRVc2VyID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgX3RoaXMgPSB0aGlzO1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdXNlcicpKS5faWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyh1c2VyKTtcbiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBfdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgQWNjb3VudENvbXBvbmVudC5wcm90b3R5cGUudXBkYXRlQ3VycmVudFVzZXIgPSBmdW5jdGlvbiAodmFsdWUsIGNhcmROYW1lKSB7XG4gICAgICAgIC8vIFNlbmQgdXBkYXRlZCB1c2VyIG9iamVjdCB0byBiYWNrZW5kXG4gICAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgICAgdGhpcy5hdXRoU2VydmljZS51cGRhdGVDdXJyZW50VXNlcih2YWx1ZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKHJlcykgeyByZXR1cm4gaGFuZGxlUmVzcG9uc2UocmVzKTsgfSwgZnVuY3Rpb24gKGVycikgeyByZXR1cm4gY29uc29sZS5sb2coJ2VyciBAdXBkYXRlVXNlcjogJywgZXJyKTsgfSk7XG4gICAgICAgIGZ1bmN0aW9uIGhhbmRsZVJlc3BvbnNlKHJlcykge1xuICAgICAgICAgICAgLy8gQWZ0ZXIgc2F2aW5nIHN1Y2Nlc3NmdWxseSBDbG9zZSB0aGUgc3BlY2lmaWMgY2FyZChmb3JtKVxuICAgICAgICAgICAgc2VsZltjYXJkTmFtZV0gPSAhKHNlbGZbY2FyZE5hbWVdKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgQWNjb3VudENvbXBvbmVudC5wcm90b3R5cGUuZWRpdCA9IGZ1bmN0aW9uIChjYXJkTmFtZSkge1xuICAgICAgICB0aGlzW2NhcmROYW1lXSA9ICEodGhpc1tjYXJkTmFtZV0pO1xuICAgICAgICB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgfTtcbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5jaGVja1JvbGUgPSBmdW5jdGlvbiAocm9sZSwgdXNlcikge1xuICAgICAgICAvLyByb2xlIGlzIHRoZSByZXF1aXJlZCByb2xlIHRvIGFjY2VzcyB0aGUgY29udGVudFxuICAgICAgICAvLyBVc2VyJ3Mgcm9sZSBtdXN0IGhhdmUgaGlnaGVyIG9yIGVxdWFsIGF1dGhvcml0eSB0byB0aGlzIHJvbGVcbiAgICAgICAgaWYgKHVzZXIpIHtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmF1dGhTZXJ2aWNlLmNoZWNrQXV0aG9yaXR5KHJvbGUsIHVzZXIucm9sZSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLnJlc2V0RXJyID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIHRoaXMucm9sZU5vdE1hdGNoU2VydmljZSA9IGZhbHNlO1xuICAgICAgICB0aGlzLmVtYWlsRXJyb3IgPSBmYWxzZTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQucHJvdG90eXBlLmFkZFNlcnZpY2UgPSBmdW5jdGlvbiAoZW1haWwsIHNlcnZpY2UpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgaWYgKGVtYWlsKSB7XG4gICAgICAgICAgICB2YXIgZGF0YV8xID0ge1xuICAgICAgICAgICAgICAgIGN1cnJlbnRVc2VyOiB0aGlzLmN1cnJlbnRVc2VyLFxuICAgICAgICAgICAgICAgIHVzZXJUb0FkZDoge31cbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICB2YXIgc2VsZl8xID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuc2VuZGluZyA9IHRydWU7XG4gICAgICAgICAgICAvL0ZpbmQgdXNlciBieSBlbWFpbFxuICAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZS5nZXRVc2VyQnlFbWFpbChlbWFpbClcbiAgICAgICAgICAgICAgICAuc3Vic2NyaWJlKGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICAgICAgLy9DaGVjayBpZiB0aGlzIHVzZXIgaGFzIHRoZSByb2xlIGZvciB0aGUgaW50ZW5kZWQgc2VydmljZVxuICAgICAgICAgICAgICAgIGlmICh1c2VyLnJvbGUgPT09IHNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YV8xLnVzZXJUb0FkZCA9IHVzZXI7XG4gICAgICAgICAgICAgICAgICAgIC8vQWRkIHVzZXIgdG8gdGhpcyB1c2VyJ3Mgc2VydmljZVxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5zZXJ2aWNlUGFja2FnZS5jcmVhdGVTZXJ2aWNlKGRhdGFfMSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZXJ2aWNlIGNyZWF0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGZfMS5zZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHNlbGZfMS5yb2xlTm90TWF0Y2hTZXJ2aWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZl8xLnNlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBzZWxmXzEuZW1haWxFcnJvciA9IHRydWU7XG4gICAgICAgICAgICAgICAgc2VsZl8xLnNlbmRpbmcgPSBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5uZ09uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF91c2VyJykpO1xuICAgICAgICB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgICAgIHRoaXMuc29ja2V0LnN5bmNCeUlkKCd1c2VyJywgdGhpcy5jdXJyZW50VXNlci5faWQsIGZ1bmN0aW9uICh1c2VyKSB7XG4gICAgICAgICAgICBzZWxmLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBBY2NvdW50Q29tcG9uZW50LnByb3RvdHlwZS5uZ09uRGVzdHJveSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdGhpcy5zb2NrZXQudW5zeW5jQnlJZCgndXNlcicsIHRoaXMuY3VycmVudFVzZXIuX2lkKTtcbiAgICB9O1xuICAgIEFjY291bnRDb21wb25lbnQgPSBfX2RlY29yYXRlKFtcbiAgICAgICAgY29yZV8xLkNvbXBvbmVudCh7XG4gICAgICAgICAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgICAgICAgICAgc2VsZWN0b3I6ICd5ZWFoLWFjY291bnQnLFxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhY2NvdW50LmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgICAgIHN0eWxlVXJsczogWydhY2NvdW50LnN0eWxlLmNzcyddLFxuICAgICAgICAgICAgcHJvdmlkZXJzOiBbYXV0aF9zZXJ2aWNlXzEuQXV0aFNlcnZpY2UsIHNvY2tldF9zZXJ2aWNlXzEuU29ja2V0U2VydmljZSwgc2VydmljZV9zZXJ2aWNlXzEuU2VydmljZVNlcnZpY2VdXG4gICAgICAgIH0pLCBcbiAgICAgICAgX19tZXRhZGF0YSgnZGVzaWduOnBhcmFtdHlwZXMnLCBbcm91dGVyXzEuUm91dGVyLCBhdXRoX3NlcnZpY2VfMS5BdXRoU2VydmljZSwgc29ja2V0X3NlcnZpY2VfMS5Tb2NrZXRTZXJ2aWNlLCBzZXJ2aWNlX3NlcnZpY2VfMS5TZXJ2aWNlU2VydmljZV0pXG4gICAgXSwgQWNjb3VudENvbXBvbmVudCk7XG4gICAgcmV0dXJuIEFjY291bnRDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0cy5BY2NvdW50Q29tcG9uZW50ID0gQWNjb3VudENvbXBvbmVudDtcbiIsImltcG9ydCB7IENvbXBvbmVudCwgT25Jbml0LCBPbkRlc3Ryb3kgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFJvdXRlciB9ICAgIGZyb20gJ0Bhbmd1bGFyL3JvdXRlcic7XG5pbXBvcnQgbW9tZW50ID0gcmVxdWlyZSgnbW9tZW50Jyk7XG5cbmltcG9ydCB7IFVzZXIgfSBmcm9tICcuLi8uLi9zaGFyZWQvdHlwZXMvdXNlcidcbmltcG9ydCB7IEF1dGhTZXJ2aWNlIH0gZnJvbSAnLi4vLi4vc2hhcmVkL3NlcnZpY2VzL2F1dGguc2VydmljZSc7XG5pbXBvcnQgeyBTZXJ2aWNlU2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9zZXJ2aWNlLnNlcnZpY2UnO1xuaW1wb3J0IHsgU29ja2V0U2VydmljZSB9IGZyb20gJy4uLy4uL3NoYXJlZC9zZXJ2aWNlcy9zb2NrZXQuc2VydmljZSc7XG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICd5ZWFoLWFjY291bnQnLFxuICAgIHRlbXBsYXRlVXJsOiAnYWNjb3VudC5jb21wb25lbnQuaHRtbCcsXG4gICAgc3R5bGVVcmxzOiBbJ2FjY291bnQuc3R5bGUuY3NzJ10sXG4gICAgcHJvdmlkZXJzOiBbQXV0aFNlcnZpY2UsIFNvY2tldFNlcnZpY2UsIFNlcnZpY2VTZXJ2aWNlXVxufSlcblxuZXhwb3J0IGNsYXNzIEFjY291bnRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSB7XG4gICAgY3VycmVudFVzZXI6IFVzZXI7XG4gICAgZWRpdEFJOiBib29sZWFuO1xuICAgIGVkaXRHSTogYm9vbGVhbjtcbiAgICBlbWFpbEVycm9yOiBib29sZWFuO1xuICAgIHNlbmRpbmc6IGJvb2xlYW47XG4gICAgcm9sZU5vdE1hdGNoU2VydmljZTogYm9vbGVhbjtcbiAgICBzZXJ2aWNlID0gJ3N0dWRlbnQnO1xuXG4gICAgY29uc3RydWN0b3IoXG4gICAgICAgIHByaXZhdGUgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgIHByaXZhdGUgYXV0aFNlcnZpY2U6IEF1dGhTZXJ2aWNlLFxuICAgICAgICBwcml2YXRlIHNvY2tldDogU29ja2V0U2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSBzZXJ2aWNlUGFja2FnZTogU2VydmljZVNlcnZpY2VcbiAgICApIHsgfVxuXG4gICAgZ2VuZXJhdGVUaW1lKHVuaXgpIHtcbiAgICAgICAgcmV0dXJuIG1vbWVudCh1bml4KS5mb3JtYXQoJ0xMTCcpO1xuICAgIH1cblxuICAgIGdlbmVyYXRlRGF0ZSh1bml4KSB7XG4gICAgICAgIHJldHVybiBtb21lbnQodW5peCkuZm9ybWF0KCdMTCcpO1xuICAgIH1cblxuICAgIGdldEN1cnJlbnRVc2VyKCkge1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdXNlcicpKS5faWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgdXNlciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2codXNlcik7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coPGFueT5lcnJvcik7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICB1cGRhdGVDdXJyZW50VXNlcih2YWx1ZTogYW55LCBjYXJkTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIC8vIFNlbmQgdXBkYXRlZCB1c2VyIG9iamVjdCB0byBiYWNrZW5kXG4gICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgXG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2UudXBkYXRlQ3VycmVudFVzZXIodmFsdWUpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgICAgIHJlcyA9PiBoYW5kbGVSZXNwb25zZShyZXMpLFxuICAgICAgICAgICAgICAgIGVyciA9PiBjb25zb2xlLmxvZygnZXJyIEB1cGRhdGVVc2VyOiAnLCBlcnIpXG4gICAgICAgICAgICApXG5cbiAgICAgICAgZnVuY3Rpb24gaGFuZGxlUmVzcG9uc2UocmVzKSB7XG4gICAgICAgICAgICAvLyBBZnRlciBzYXZpbmcgc3VjY2Vzc2Z1bGx5IENsb3NlIHRoZSBzcGVjaWZpYyBjYXJkKGZvcm0pXG4gICAgICAgICAgICBzZWxmW2NhcmROYW1lXSA9ICEoc2VsZltjYXJkTmFtZV0pO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgZWRpdChjYXJkTmFtZTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXNbY2FyZE5hbWVdID0gISh0aGlzW2NhcmROYW1lXSk7XG4gICAgICAgIHRoaXMuZ2V0Q3VycmVudFVzZXIoKTtcbiAgICB9XG5cbiAgICBjaGVja1JvbGUocm9sZTogc3RyaW5nLCB1c2VyOiBVc2VyKSB7XG4gICAgICAgIC8vIHJvbGUgaXMgdGhlIHJlcXVpcmVkIHJvbGUgdG8gYWNjZXNzIHRoZSBjb250ZW50XG4gICAgICAgIC8vIFVzZXIncyByb2xlIG11c3QgaGF2ZSBoaWdoZXIgb3IgZXF1YWwgYXV0aG9yaXR5IHRvIHRoaXMgcm9sZVxuICAgICAgICBpZih1c2VyKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5hdXRoU2VydmljZS5jaGVja0F1dGhvcml0eShyb2xlLCB1c2VyLnJvbGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmVzZXRFcnIoZXZlbnQ6IGFueSkge1xuICAgICAgICB0aGlzLnJvbGVOb3RNYXRjaFNlcnZpY2UgPSBmYWxzZTtcbiAgICAgICAgdGhpcy5lbWFpbEVycm9yID0gZmFsc2U7XG4gICAgfVxuXG4gICAgYWRkU2VydmljZShlbWFpbDogc3RyaW5nLCBzZXJ2aWNlOnN0cmluZykge1xuICAgICAgICBpZihlbWFpbCkge1xuICAgICAgICAgICAgbGV0IGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgY3VycmVudFVzZXI6IHRoaXMuY3VycmVudFVzZXIsXG4gICAgICAgICAgICAgICAgdXNlclRvQWRkOiB7fVxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGxldCBzZWxmID0gdGhpcztcbiAgICAgICAgICAgIHRoaXMuc2VuZGluZyA9IHRydWU7XG4gICAgICAgICAgICAvL0ZpbmQgdXNlciBieSBlbWFpbFxuXG4gICAgICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldFVzZXJCeUVtYWlsKGVtYWlsKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgIHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgIC8vQ2hlY2sgaWYgdGhpcyB1c2VyIGhhcyB0aGUgcm9sZSBmb3IgdGhlIGludGVuZGVkIHNlcnZpY2VcbiAgICAgICAgICAgICAgICBpZih1c2VyLnJvbGUgPT09IHNlcnZpY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS51c2VyVG9BZGQgPSB1c2VyO1xuICAgICAgICAgICAgICAgICAgICAvL0FkZCB1c2VyIHRvIHRoaXMgdXNlcidzIHNlcnZpY2VcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXJ2aWNlUGFja2FnZS5jcmVhdGVTZXJ2aWNlKGRhdGEpXG4gICAgICAgICAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICAgICAgICAgIHVzZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NlcnZpY2UgY3JlYXRlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5yb2xlTm90TWF0Y2hTZXJ2aWNlID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zZW5kaW5nID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBzZWxmLmVtYWlsRXJyb3IgPSB0cnVlO1xuICAgICAgICAgICAgICAgIHNlbGYuc2VuZGluZyA9IGZhbHNlO1xuICAgICAgICAgICAgfSk7ICAgXG4gICAgICAgIH0gICBcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF91c2VyJykpO1xuICAgICAgICB0aGlzLmdldEN1cnJlbnRVc2VyKCk7XG4gICAgICAgIHRoaXMuc29ja2V0LnN5bmNCeUlkKCd1c2VyJywgdGhpcy5jdXJyZW50VXNlci5faWQsIGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIHNlbGYuY3VycmVudFVzZXIgPSB1c2VyO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ09uRGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5zb2NrZXQudW5zeW5jQnlJZCgndXNlcicsIHRoaXMuY3VycmVudFVzZXIuX2lkKTtcbiAgICB9XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
