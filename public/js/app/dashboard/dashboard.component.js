"use strict";var __decorate=this&&this.__decorate||function(e,t,o,i){var r,n=arguments.length,c=n<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,o,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(c=(n<3?r(c):n>3?r(t,o,c):r(t,o))||c);return n>3&&c&&Object.defineProperty(t,o,c),c},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},core_1=require("@angular/core"),router_1=require("@angular/router"),auth_service_1=require("../shared/services/auth.service"),notification_service_1=require("../shared/services/notification.service"),socket_service_1=require("../shared/services/socket.service"),DashboardComponent=function(){function e(e,t,o,i){this.authService=e,this.router=t,this.socket=o,this.noticeService=i,this.profileToggled=!1,this.inboxToggled=!1,this.options={timeOut:5e3,lastOnBottom:!0,clickToClose:!0,maxLength:0,maxStack:7,showProgressBar:!0,pauseOnHover:!0,preventDuplicates:!1,preventLastDuplicates:"visible",rtl:!1,animate:"scale",position:["right","bottom"]}}return e.prototype.checkMenuStyle=function(e){this.currentSession=e},e.prototype.logout=function(){this.authService.logUserOut()},e.prototype.getUser=function(){var e=this;this.authService.getCurrentUser(JSON.parse(localStorage.getItem("current_user"))._id).subscribe(function(t){e.currentUserRole=t.role,e.currentUser=t},function(t){e.authService.logUserOut(),console.log(t)})},e.prototype.getNotification=function(e){var t=this;this.noticeService.getThree().subscribe(function(o){t.notifications=o,e()},function(t){console.log(t),e()})},e.prototype.getNotificationCount=function(){var e=this;this.noticeService.getCount().subscribe(function(t){isNaN(t)?e.noticeCount=null:e.noticeCount=t},function(e){console.log(e)})},e.prototype.respondToInvitation=function(e,t){t?e.response=!0:e.response=!1,this.noticeService.confirmInvitation(e).subscribe(function(e){console.log("confirmed")},function(e){console.log(e)})},e.prototype.checkNotications=function(e,t){var o=!1;this.notifications.forEach(function(i){if(e._id===i._id)return o=!0,void t(o)}),t(o)},e.prototype.ngOnInit=function(){this.currentUser=JSON.parse(localStorage.getItem("current_user")),this.getUser();var e=this;this.getNotification(function(){e.socket.syncById("notification",e.currentUser._id,function(t){e.checkNotications(t,function(o){return o?void(t.read&&e.noticeCount--):(e.notifications.unshift(t),e.notifications.length>3&&e.notifications.pop(),t.read||e.noticeCount++,void 0)})})}),this.getNotificationCount()},e.prototype.ngOnDestroy=function(){this.socket.unsyncById("notification",this.currentUser._id)},e=__decorate([core_1.Component({moduleId:module.id,selector:"yeah-dashboard",templateUrl:"dashboard.component.html",directives:[router_1.ROUTER_DIRECTIVES],providers:[auth_service_1.AuthService,socket_service_1.SocketService,notification_service_1.NoticeService],styleUrls:["dashboard.style.css"]}),__metadata("design:paramtypes",[auth_service_1.AuthService,router_1.Router,socket_service_1.SocketService,notification_service_1.NoticeService])],e)}();exports.DashboardComponent=DashboardComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRhc2hib2FyZC9kYXNoYm9hcmQuY29tcG9uZW50LmpzIiwiZGFzaGJvYXJkL2Rhc2hib2FyZC5jb21wb25lbnQudHMiXSwibmFtZXMiOlsiX19kZWNvcmF0ZSIsInRoaXMiLCJkZWNvcmF0b3JzIiwidGFyZ2V0Iiwia2V5IiwiZGVzYyIsImQiLCJjIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fbWV0YWRhdGEiLCJrIiwidiIsIm1ldGFkYXRhIiwiY29yZV8xIiwicmVxdWlyZSIsInJvdXRlcl8xIiwiYXV0aF9zZXJ2aWNlXzEiLCJub3RpZmljYXRpb25fc2VydmljZV8xIiwic29ja2V0X3NlcnZpY2VfMSIsIkRhc2hib2FyZENvbXBvbmVudCIsImF1dGhTZXJ2aWNlIiwicm91dGVyIiwic29ja2V0Iiwibm90aWNlU2VydmljZSIsInByb2ZpbGVUb2dnbGVkIiwiaW5ib3hUb2dnbGVkIiwib3B0aW9ucyIsInRpbWVPdXQiLCJsYXN0T25Cb3R0b20iLCJjbGlja1RvQ2xvc2UiLCJtYXhMZW5ndGgiLCJtYXhTdGFjayIsInNob3dQcm9ncmVzc0JhciIsInBhdXNlT25Ib3ZlciIsInByZXZlbnREdXBsaWNhdGVzIiwicHJldmVudExhc3REdXBsaWNhdGVzIiwicnRsIiwiYW5pbWF0ZSIsInBvc2l0aW9uIiwicHJvdG90eXBlIiwiY2hlY2tNZW51U3R5bGUiLCJpdGVtIiwiY3VycmVudFNlc3Npb24iLCJsb2dvdXQiLCJsb2dVc2VyT3V0IiwiZ2V0VXNlciIsIl90aGlzIiwiZ2V0Q3VycmVudFVzZXIiLCJKU09OIiwicGFyc2UiLCJsb2NhbFN0b3JhZ2UiLCJnZXRJdGVtIiwiX2lkIiwic3Vic2NyaWJlIiwidXNlciIsImN1cnJlbnRVc2VyUm9sZSIsInJvbGUiLCJjdXJyZW50VXNlciIsImVycm9yIiwiY29uc29sZSIsImxvZyIsImdldE5vdGlmaWNhdGlvbiIsImNiIiwiZ2V0VGhyZWUiLCJub3RpY2VzIiwibm90aWZpY2F0aW9ucyIsImdldE5vdGlmaWNhdGlvbkNvdW50Iiwic2VsZiIsImdldENvdW50IiwiY291bnQiLCJpc05hTiIsIm5vdGljZUNvdW50IiwicmVzcG9uZFRvSW52aXRhdGlvbiIsIm5vdGljZSIsInJlc3BvbnNlIiwiY29uZmlybUludml0YXRpb24iLCJjaGVja05vdGljYXRpb25zIiwiZXhpc3QiLCJmb3JFYWNoIiwiZWFjaE5vdGljZU5vdyIsIm5nT25Jbml0Iiwic3luY0J5SWQiLCJyZWFkIiwidW5zaGlmdCIsInBvcCIsIm5nT25EZXN0cm95IiwidW5zeW5jQnlJZCIsIkNvbXBvbmVudCIsIm1vZHVsZUlkIiwibW9kdWxlIiwiaWQiLCJzZWxlY3RvciIsInRlbXBsYXRlVXJsIiwiZGlyZWN0aXZlcyIsIlJPVVRFUl9ESVJFQ1RJVkVTIiwicHJvdmlkZXJzIiwiQXV0aFNlcnZpY2UiLCJTb2NrZXRTZXJ2aWNlIiwiTm90aWNlU2VydmljZSIsInN0eWxlVXJscyIsIlJvdXRlciIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQ0EsSUFBSUEsWUFBY0MsTUFBUUEsS0FBS0QsWUFBZSxTQUFVRSxFQUFZQyxFQUFRQyxFQUFLQyxHQUM3RSxHQUEySEMsR0FBdkhDLEVBQUlDLFVBQVVDLE9BQVFDLEVBQUlILEVBQUksRUFBSUosRUFBa0IsT0FBVEUsRUFBZ0JBLEVBQU9NLE9BQU9DLHlCQUF5QlQsRUFBUUMsR0FBT0MsQ0FDckgsSUFBdUIsZ0JBQVpRLFVBQW9ELGtCQUFyQkEsU0FBUUMsU0FBeUJKLEVBQUlHLFFBQVFDLFNBQVNaLEVBQVlDLEVBQVFDLEVBQUtDLE9BQ3BILEtBQUssR0FBSVUsR0FBSWIsRUFBV08sT0FBUyxFQUFHTSxHQUFLLEVBQUdBLEtBQVNULEVBQUlKLEVBQVdhLE1BQUlMLEdBQUtILEVBQUksRUFBSUQsRUFBRUksR0FBS0gsRUFBSSxFQUFJRCxFQUFFSCxFQUFR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cUIsR0FDaEVOLEVBQUtTLGlCQUFpQkgsRUFBUSxTQUFTSSxHQUVuQyxNQUFHQSxRQUNJSixFQUFPUyxNQUNOZixFQUFLSSxnQkFLVEosRUFBS0YsY0FBY2tCLFFBQVFWLEdBRXhCTixFQUFLRixjQUFjaEUsT0FBUyxHQUMzQmtFLEVBQUtGLGNBQWNtQixNQUVuQlgsRUFBT1MsTUFDUGYsRUFBS0ksY0FOVEosY0FZaEIxRSxLQUFLeUUsd0JBSVQvQyxFQUFBb0IsVUFBQThDLFlBQUEsV0FDSTVGLEtBQUs2QixPQUFPZ0UsV0FBVyxlQUFnQjdGLEtBQUtnRSxZQUFZTCxNQTlKaEVqQyxFQUFBM0IsWUFBQ3FCLE9BQUEwRSxXQUNHQyxTQUFVQyxPQUFPQyxHQUNqQkMsU0FBVSxpQkFDVkMsWUFBYSwyQkFDYkMsWUFBYTlFLFNBQUErRSxtQkFDYkMsV0FBWS9FLGVBQUFnRixZQUFhOUUsaUJBQUErRSxjQUFlaEYsdUJBQUFpRixlQUN4Q0MsV0FBWSx5QkR3SVIxRixXQUFXLHFCQUFzQk8sZUFBZWdGLFlBQWFqRixTQUFTcUYsT0FBUWxGLGlCQUFpQitFLGNBQWVoRix1QkFBdUJpRixpQkFDdEkvRSxLQ3RJTWtGLFNBQUFsRixtQkFBa0JBIiwiZmlsZSI6ImRhc2hib2FyZC9kYXNoYm9hcmQuY29tcG9uZW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG52YXIgX19kZWNvcmF0ZSA9ICh0aGlzICYmIHRoaXMuX19kZWNvcmF0ZSkgfHwgZnVuY3Rpb24gKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKSB7XG4gICAgdmFyIGMgPSBhcmd1bWVudHMubGVuZ3RoLCByID0gYyA8IDMgPyB0YXJnZXQgOiBkZXNjID09PSBudWxsID8gZGVzYyA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IodGFyZ2V0LCBrZXkpIDogZGVzYywgZDtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QuZGVjb3JhdGUgPT09IFwiZnVuY3Rpb25cIikgciA9IFJlZmxlY3QuZGVjb3JhdGUoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpO1xuICAgIGVsc2UgZm9yICh2YXIgaSA9IGRlY29yYXRvcnMubGVuZ3RoIC0gMTsgaSA+PSAwOyBpLS0pIGlmIChkID0gZGVjb3JhdG9yc1tpXSkgciA9IChjIDwgMyA/IGQocikgOiBjID4gMyA/IGQodGFyZ2V0LCBrZXksIHIpIDogZCh0YXJnZXQsIGtleSkpIHx8IHI7XG4gICAgcmV0dXJuIGMgPiAzICYmIHIgJiYgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRhcmdldCwga2V5LCByKSwgcjtcbn07XG52YXIgX19tZXRhZGF0YSA9ICh0aGlzICYmIHRoaXMuX19tZXRhZGF0YSkgfHwgZnVuY3Rpb24gKGssIHYpIHtcbiAgICBpZiAodHlwZW9mIFJlZmxlY3QgPT09IFwib2JqZWN0XCIgJiYgdHlwZW9mIFJlZmxlY3QubWV0YWRhdGEgPT09IFwiZnVuY3Rpb25cIikgcmV0dXJuIFJlZmxlY3QubWV0YWRhdGEoaywgdik7XG59O1xudmFyIGNvcmVfMSA9IHJlcXVpcmUoJ0Bhbmd1bGFyL2NvcmUnKTtcbnZhciByb3V0ZXJfMSA9IHJlcXVpcmUoJ0Bhbmd1bGFyL3JvdXRlcicpO1xudmFyIGF1dGhfc2VydmljZV8xID0gcmVxdWlyZSgnLi4vc2hhcmVkL3NlcnZpY2VzL2F1dGguc2VydmljZScpO1xudmFyIG5vdGlmaWNhdGlvbl9zZXJ2aWNlXzEgPSByZXF1aXJlKCcuLi9zaGFyZWQvc2VydmljZXMvbm90aWZpY2F0aW9uLnNlcnZpY2UnKTtcbnZhciBzb2NrZXRfc2VydmljZV8xID0gcmVxdWlyZSgnLi4vc2hhcmVkL3NlcnZpY2VzL3NvY2tldC5zZXJ2aWNlJyk7XG4vLyBpbXBvcnQgeyBOb3RpZmljYXRpb25zU2VydmljZSwgU2ltcGxlTm90aWZpY2F0aW9uc0NvbXBvbmVudCB9IGZyb20gJ25vdGlmaWNhdGlvbnMnO1xudmFyIERhc2hib2FyZENvbXBvbmVudCA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gRGFzaGJvYXJkQ29tcG9uZW50KGF1dGhTZXJ2aWNlLCByb3V0ZXIsIHNvY2tldCwgbm90aWNlU2VydmljZSkge1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlID0gYXV0aFNlcnZpY2U7XG4gICAgICAgIHRoaXMucm91dGVyID0gcm91dGVyO1xuICAgICAgICB0aGlzLnNvY2tldCA9IHNvY2tldDtcbiAgICAgICAgdGhpcy5ub3RpY2VTZXJ2aWNlID0gbm90aWNlU2VydmljZTtcbiAgICAgICAgdGhpcy5wcm9maWxlVG9nZ2xlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLmluYm94VG9nZ2xlZCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm9wdGlvbnMgPSB7XG4gICAgICAgICAgICB0aW1lT3V0OiA1MDAwLFxuICAgICAgICAgICAgbGFzdE9uQm90dG9tOiB0cnVlLFxuICAgICAgICAgICAgY2xpY2tUb0Nsb3NlOiB0cnVlLFxuICAgICAgICAgICAgbWF4TGVuZ3RoOiAwLFxuICAgICAgICAgICAgbWF4U3RhY2s6IDcsXG4gICAgICAgICAgICBzaG93UHJvZ3Jlc3NCYXI6IHRydWUsXG4gICAgICAgICAgICBwYXVzZU9uSG92ZXI6IHRydWUsXG4gICAgICAgICAgICBwcmV2ZW50RHVwbGljYXRlczogZmFsc2UsXG4gICAgICAgICAgICBwcmV2ZW50TGFzdER1cGxpY2F0ZXM6IFwidmlzaWJsZVwiLFxuICAgICAgICAgICAgcnRsOiBmYWxzZSxcbiAgICAgICAgICAgIGFuaW1hdGU6IFwic2NhbGVcIixcbiAgICAgICAgICAgIHBvc2l0aW9uOiBbXCJyaWdodFwiLCBcImJvdHRvbVwiXVxuICAgICAgICB9O1xuICAgIH1cbiAgICBEYXNoYm9hcmRDb21wb25lbnQucHJvdG90eXBlLmNoZWNrTWVudVN0eWxlID0gZnVuY3Rpb24gKGl0ZW0pIHtcbiAgICAgICAgdGhpcy5jdXJyZW50U2Vzc2lvbiA9IGl0ZW07XG4gICAgfTtcbiAgICBEYXNoYm9hcmRDb21wb25lbnQucHJvdG90eXBlLmxvZ291dCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gdGhlIHNlcnZpY2Ugd2lsbCBkZWxldGUgdXNlciBkYXRhIGFuZCB0b2tlbiBpbiBsb2NhbFN0b3JhZ2VcbiAgICAgICAgLy8gYW5kIGJyaW5nIHVzZXIgb3V0IG9mIHRoZSBkYXNoYm9hcmRcbiAgICAgICAgdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgfTtcbiAgICBEYXNoYm9hcmRDb21wb25lbnQucHJvdG90eXBlLmdldFVzZXIgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBfdGhpcyA9IHRoaXM7XG4gICAgICAgIHRoaXMuYXV0aFNlcnZpY2UuZ2V0Q3VycmVudFVzZXIoSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF91c2VyJykpLl9pZClcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKHVzZXIpIHtcbiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRVc2VyUm9sZSA9IHVzZXIucm9sZTtcbiAgICAgICAgICAgIF90aGlzLmN1cnJlbnRVc2VyID0gdXNlcjtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBfdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRGFzaGJvYXJkQ29tcG9uZW50LnByb3RvdHlwZS5nZXROb3RpZmljYXRpb24gPSBmdW5jdGlvbiAoY2IpIHtcbiAgICAgICAgdmFyIF90aGlzID0gdGhpcztcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLm5vdGljZVNlcnZpY2UuZ2V0VGhyZWUoKVxuICAgICAgICAgICAgLnN1YnNjcmliZShmdW5jdGlvbiAobm90aWNlcykge1xuICAgICAgICAgICAgX3RoaXMubm90aWZpY2F0aW9ucyA9IG5vdGljZXM7XG4gICAgICAgICAgICBjYigpO1xuICAgICAgICB9LCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKTtcbiAgICAgICAgICAgIGNiKCk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRGFzaGJvYXJkQ29tcG9uZW50LnByb3RvdHlwZS5nZXROb3RpZmljYXRpb25Db3VudCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLm5vdGljZVNlcnZpY2UuZ2V0Q291bnQoKVxuICAgICAgICAgICAgLnN1YnNjcmliZShmdW5jdGlvbiAoY291bnQpIHtcbiAgICAgICAgICAgIGlmIChpc05hTihjb3VudCkpIHtcbiAgICAgICAgICAgICAgICBzZWxmLm5vdGljZUNvdW50ID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlbGYubm90aWNlQ291bnQgPSBjb3VudDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRGFzaGJvYXJkQ29tcG9uZW50LnByb3RvdHlwZS5yZXNwb25kVG9JbnZpdGF0aW9uID0gZnVuY3Rpb24gKG5vdGljZSwgcmVzcG9uc2UpIHtcbiAgICAgICAgaWYgKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBub3RpY2UucmVzcG9uc2UgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm90aWNlLnJlc3BvbnNlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ub3RpY2VTZXJ2aWNlLmNvbmZpcm1JbnZpdGF0aW9uKG5vdGljZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoZnVuY3Rpb24gKG5vdGljZSkge1xuICAgICAgICAgICAgLy9cbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjb25maXJtZWQnKTtcbiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgRGFzaGJvYXJkQ29tcG9uZW50LnByb3RvdHlwZS5jaGVja05vdGljYXRpb25zID0gZnVuY3Rpb24gKG5vdGljZSwgY2IpIHtcbiAgICAgICAgdmFyIGV4aXN0ID0gZmFsc2U7XG4gICAgICAgIHRoaXMubm90aWZpY2F0aW9ucy5mb3JFYWNoKGZ1bmN0aW9uIChlYWNoTm90aWNlTm93KSB7XG4gICAgICAgICAgICBpZiAobm90aWNlLl9pZCA9PT0gZWFjaE5vdGljZU5vdy5faWQpIHtcbiAgICAgICAgICAgICAgICBleGlzdCA9IHRydWU7XG4gICAgICAgICAgICAgICAgY2IoZXhpc3QpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIGNiKGV4aXN0KTtcbiAgICB9O1xuICAgIERhc2hib2FyZENvbXBvbmVudC5wcm90b3R5cGUubmdPbkluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFVzZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50X3VzZXInKSk7XG4gICAgICAgIHRoaXMuZ2V0VXNlcigpO1xuICAgICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMuZ2V0Tm90aWZpY2F0aW9uKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIC8vTGlzdGVuIHRvIHVwZGF0ZXMgYWZ0ZXIgbG9hZGluZyB0aGUgZmlyc3QgdGhyZWUgbm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgc2VsZi5zb2NrZXQuc3luY0J5SWQoJ25vdGlmaWNhdGlvbicsIHNlbGYuY3VycmVudFVzZXIuX2lkLCBmdW5jdGlvbiAobm90aWNlKSB7XG4gICAgICAgICAgICAgICAgc2VsZi5jaGVja05vdGljYXRpb25zKG5vdGljZSwgZnVuY3Rpb24gKGV4aXN0KSB7XG4gICAgICAgICAgICAgICAgICAgIC8vSWYgbm90aWZpY2F0aW9uIGFscmVhZHkgZXhpc3Qgb25seSB1cGRhdGUgcmVhZCBjb3VudFxuICAgICAgICAgICAgICAgICAgICBpZiAoZXhpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChub3RpY2UucmVhZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYubm90aWNlQ291bnQtLTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNlbGYubm90aWZpY2F0aW9uU2VydmljZS5zdWNjZXNzKG5vdGljZS50aXRsZSwgbm90aWNlLmRlc2NyaXB0aW9uLCB7aWQ6IDEyM30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpZmljYXRpb25zLnVuc2hpZnQobm90aWNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vT25seSBkaXNwbGF5IHRocmVlIG1lc3NhZ2VzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoc2VsZi5ub3RpZmljYXRpb25zLmxlbmd0aCA+IDMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm5vdGlmaWNhdGlvbnMucG9wKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIW5vdGljZS5yZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpY2VDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2V0Tm90aWZpY2F0aW9uQ291bnQoKTtcbiAgICB9O1xuICAgIERhc2hib2FyZENvbXBvbmVudC5wcm90b3R5cGUubmdPbkRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHRoaXMuc29ja2V0LnVuc3luY0J5SWQoJ25vdGlmaWNhdGlvbicsIHRoaXMuY3VycmVudFVzZXIuX2lkKTtcbiAgICB9O1xuICAgIERhc2hib2FyZENvbXBvbmVudCA9IF9fZGVjb3JhdGUoW1xuICAgICAgICBjb3JlXzEuQ29tcG9uZW50KHtcbiAgICAgICAgICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgICAgICAgICBzZWxlY3RvcjogJ3llYWgtZGFzaGJvYXJkJyxcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnZGFzaGJvYXJkLmNvbXBvbmVudC5odG1sJyxcbiAgICAgICAgICAgIGRpcmVjdGl2ZXM6IFtyb3V0ZXJfMS5ST1VURVJfRElSRUNUSVZFU10sXG4gICAgICAgICAgICBwcm92aWRlcnM6IFthdXRoX3NlcnZpY2VfMS5BdXRoU2VydmljZSwgc29ja2V0X3NlcnZpY2VfMS5Tb2NrZXRTZXJ2aWNlLCBub3RpZmljYXRpb25fc2VydmljZV8xLk5vdGljZVNlcnZpY2VdLFxuICAgICAgICAgICAgc3R5bGVVcmxzOiBbJ2Rhc2hib2FyZC5zdHlsZS5jc3MnXVxuICAgICAgICB9KSwgXG4gICAgICAgIF9fbWV0YWRhdGEoJ2Rlc2lnbjpwYXJhbXR5cGVzJywgW2F1dGhfc2VydmljZV8xLkF1dGhTZXJ2aWNlLCByb3V0ZXJfMS5Sb3V0ZXIsIHNvY2tldF9zZXJ2aWNlXzEuU29ja2V0U2VydmljZSwgbm90aWZpY2F0aW9uX3NlcnZpY2VfMS5Ob3RpY2VTZXJ2aWNlXSlcbiAgICBdLCBEYXNoYm9hcmRDb21wb25lbnQpO1xuICAgIHJldHVybiBEYXNoYm9hcmRDb21wb25lbnQ7XG59KCkpO1xuZXhwb3J0cy5EYXNoYm9hcmRDb21wb25lbnQgPSBEYXNoYm9hcmRDb21wb25lbnQ7XG4iLCJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBST1VURVJfRElSRUNUSVZFUywgUm91dGVyIH0gZnJvbSAnQGFuZ3VsYXIvcm91dGVyJztcblxuaW1wb3J0IHsgQXV0aFNlcnZpY2UgfSBmcm9tICcuLi9zaGFyZWQvc2VydmljZXMvYXV0aC5zZXJ2aWNlJztcbmltcG9ydCB7IE5vdGljZVNlcnZpY2UgfSBmcm9tICcuLi9zaGFyZWQvc2VydmljZXMvbm90aWZpY2F0aW9uLnNlcnZpY2UnO1xuaW1wb3J0IHsgU29ja2V0U2VydmljZSB9IGZyb20gJy4uL3NoYXJlZC9zZXJ2aWNlcy9zb2NrZXQuc2VydmljZSc7XG5pbXBvcnQgeyBVc2VyIH0gZnJvbSAnLi4vc2hhcmVkL3R5cGVzL3VzZXInO1xuaW1wb3J0IHsgTm90aWZpY2F0aW9uIH0gZnJvbSAnLi4vc2hhcmVkL3R5cGVzL25vdGlmaWNhdGlvbic7XG4vLyBpbXBvcnQgeyBOb3RpZmljYXRpb25zU2VydmljZSwgU2ltcGxlTm90aWZpY2F0aW9uc0NvbXBvbmVudCB9IGZyb20gJ25vdGlmaWNhdGlvbnMnO1xuXG5cbkBDb21wb25lbnQoe1xuICAgIG1vZHVsZUlkOiBtb2R1bGUuaWQsXG4gICAgc2VsZWN0b3I6ICd5ZWFoLWRhc2hib2FyZCcsXG4gICAgdGVtcGxhdGVVcmw6ICdkYXNoYm9hcmQuY29tcG9uZW50Lmh0bWwnLFxuICAgIGRpcmVjdGl2ZXM6IFtST1VURVJfRElSRUNUSVZFU10sXG4gICAgcHJvdmlkZXJzOiBbQXV0aFNlcnZpY2UsIFNvY2tldFNlcnZpY2UsIE5vdGljZVNlcnZpY2VdLFxuICAgIHN0eWxlVXJsczogWydkYXNoYm9hcmQuc3R5bGUuY3NzJ11cbn0pXG5cbmV4cG9ydCBjbGFzcyBEYXNoYm9hcmRDb21wb25lbnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveXtcbiAgICAvLyBzZXJ2ZSBmb3IgdGhlIHR3byBkcm9wZG93biBsaXN0IGluIHRvcC1yaWdodCBvZiB0aGUgbmF2YmFyXG4gICAgY3VycmVudFVzZXI6IFVzZXI7XG4gICAgcHJvZmlsZVRvZ2dsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBpbmJveFRvZ2dsZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgICBjdXJyZW50U2Vzc2lvbjogc3RyaW5nO1xuICAgIGN1cnJlbnRVc2VyUm9sZTogc3RyaW5nO1xuICAgIG5vdGlmaWNhdGlvbnM6IEFycmF5PE5vdGlmaWNhdGlvbj47XG4gICAgbm90aWNlQ291bnQ6IG51bWJlcjtcblxuICAgIGNvbnN0cnVjdG9yKFxuICAgICAgICBwcml2YXRlIGF1dGhTZXJ2aWNlOiBBdXRoU2VydmljZSxcbiAgICAgICAgcHJpdmF0ZSByb3V0ZXI6IFJvdXRlcixcbiAgICAgICAgcHJpdmF0ZSBzb2NrZXQ6IFNvY2tldFNlcnZpY2UsXG4gICAgICAgIHByaXZhdGUgbm90aWNlU2VydmljZTogTm90aWNlU2VydmljZSxcbiAgICAgICAgLy8gcHJpdmF0ZSBub3RpZmljYXRpb25TZXJ2aWNlOiBOb3RpZmljYXRpb25zU2VydmljZVxuXG4gICAgKXt9XG5cbiAgICBwdWJsaWMgb3B0aW9ucyA9IHtcbiAgICAgICAgdGltZU91dDogNTAwMCxcbiAgICAgICAgbGFzdE9uQm90dG9tOiB0cnVlLFxuICAgICAgICBjbGlja1RvQ2xvc2U6IHRydWUsXG4gICAgICAgIG1heExlbmd0aDogMCxcbiAgICAgICAgbWF4U3RhY2s6IDcsXG4gICAgICAgIHNob3dQcm9ncmVzc0JhcjogdHJ1ZSxcbiAgICAgICAgcGF1c2VPbkhvdmVyOiB0cnVlLFxuICAgICAgICBwcmV2ZW50RHVwbGljYXRlczogZmFsc2UsXG4gICAgICAgIHByZXZlbnRMYXN0RHVwbGljYXRlczogXCJ2aXNpYmxlXCIsXG4gICAgICAgIHJ0bDogZmFsc2UsXG4gICAgICAgIGFuaW1hdGU6IFwic2NhbGVcIixcbiAgICAgICAgcG9zaXRpb246IFtcInJpZ2h0XCIsIFwiYm90dG9tXCJdXG4gICAgfVxuXG4gICAgY2hlY2tNZW51U3R5bGUoaXRlbTogc3RyaW5nKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFNlc3Npb24gPSBpdGVtO1xuICAgIH1cblxuICAgIGxvZ291dCgpIHtcbiAgICAgICAgLy8gdGhlIHNlcnZpY2Ugd2lsbCBkZWxldGUgdXNlciBkYXRhIGFuZCB0b2tlbiBpbiBsb2NhbFN0b3JhZ2VcbiAgICAgICAgLy8gYW5kIGJyaW5nIHVzZXIgb3V0IG9mIHRoZSBkYXNoYm9hcmRcbiAgICAgICAgdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KClcbiAgICB9XG5cbiAgICBnZXRVc2VyKCkge1xuICAgICAgICB0aGlzLmF1dGhTZXJ2aWNlLmdldEN1cnJlbnRVc2VyKEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRfdXNlcicpKS5faWQpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgdXNlciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlclJvbGUgPSB1c2VyLnJvbGU7XG4gICAgICAgICAgICAgICAgdGhpcy5jdXJyZW50VXNlciA9IHVzZXJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5hdXRoU2VydmljZS5sb2dVc2VyT3V0KCk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coPGFueT5lcnJvcilcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIGdldE5vdGlmaWNhdGlvbihjYikge1xuICAgICAgICBsZXQgc2VsZiA9IHRoaXM7XG4gICAgICAgIHRoaXMubm90aWNlU2VydmljZS5nZXRUaHJlZSgpXG4gICAgICAgICAgICAuc3Vic2NyaWJlKFxuICAgICAgICAgICAgbm90aWNlcyA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5ub3RpZmljYXRpb25zID0gbm90aWNlcztcbiAgICAgICAgICAgICAgICBjYigpO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyg8YW55PmVycm9yKVxuICAgICAgICAgICAgICAgIGNiKCk7XG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBnZXROb3RpZmljYXRpb25Db3VudCgpIHtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLm5vdGljZVNlcnZpY2UuZ2V0Q291bnQoKVxuICAgICAgICAgICAgLnN1YnNjcmliZShcbiAgICAgICAgICAgIGNvdW50ID0+IHtcbiAgICAgICAgICAgICAgICBpZihpc05hTihjb3VudCkpIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpY2VDb3VudCA9IG51bGw7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpY2VDb3VudCA9IGNvdW50O1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlcnJvciA9PiB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coPGFueT5lcnJvcilcbiAgICAgICAgICAgIH0pO1xuICAgIH1cblxuICAgIHJlc3BvbmRUb0ludml0YXRpb24obm90aWNlOiBOb3RpZmljYXRpb24sIHJlc3BvbnNlOiBib29sZWFuKSB7XG4gICAgICAgIGlmKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBub3RpY2UucmVzcG9uc2UgPSB0cnVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbm90aWNlLnJlc3BvbnNlID0gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5ub3RpY2VTZXJ2aWNlLmNvbmZpcm1JbnZpdGF0aW9uKG5vdGljZSlcbiAgICAgICAgICAgIC5zdWJzY3JpYmUoXG4gICAgICAgICAgICBub3RpY2UgPT4ge1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvbmZpcm1lZCcpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKDxhbnk+ZXJyb3IpXG4gICAgICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBjaGVja05vdGljYXRpb25zKG5vdGljZTogTm90aWZpY2F0aW9uLCBjYjogYW55KSB7XG4gICAgICAgIGxldCBleGlzdCA9IGZhbHNlO1xuICAgICAgICB0aGlzLm5vdGlmaWNhdGlvbnMuZm9yRWFjaChmdW5jdGlvbihlYWNoTm90aWNlTm93KSB7XG4gICAgICAgICAgICBpZihub3RpY2UuX2lkID09PSBlYWNoTm90aWNlTm93Ll9pZCkge1xuICAgICAgICAgICAgICAgIGV4aXN0ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBjYihleGlzdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgY2IoZXhpc3QpO1xuICAgIH1cblxuICAgIG5nT25Jbml0KCkge1xuICAgICAgICB0aGlzLmN1cnJlbnRVc2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudF91c2VyJykpO1xuICAgICAgICB0aGlzLmdldFVzZXIoKTtcbiAgICAgICAgbGV0IHNlbGYgPSB0aGlzO1xuICAgICAgICB0aGlzLmdldE5vdGlmaWNhdGlvbihmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIC8vTGlzdGVuIHRvIHVwZGF0ZXMgYWZ0ZXIgbG9hZGluZyB0aGUgZmlyc3QgdGhyZWUgbm90aWZpY2F0aW9uc1xuICAgICAgICAgICAgc2VsZi5zb2NrZXQuc3luY0J5SWQoJ25vdGlmaWNhdGlvbicsIHNlbGYuY3VycmVudFVzZXIuX2lkLCBmdW5jdGlvbihub3RpY2UpIHtcbiAgICAgICAgICAgICAgICBzZWxmLmNoZWNrTm90aWNhdGlvbnMobm90aWNlLCBmdW5jdGlvbihleGlzdCkge1xuICAgICAgICAgICAgICAgICAgICAvL0lmIG5vdGlmaWNhdGlvbiBhbHJlYWR5IGV4aXN0IG9ubHkgdXBkYXRlIHJlYWQgY291bnRcbiAgICAgICAgICAgICAgICAgICAgaWYoZXhpc3QpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKG5vdGljZS5yZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpY2VDb3VudC0tO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2VsZi5ub3RpZmljYXRpb25TZXJ2aWNlLnN1Y2Nlc3Mobm90aWNlLnRpdGxlLCBub3RpY2UuZGVzY3JpcHRpb24sIHtpZDogMTIzfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBzZWxmLm5vdGlmaWNhdGlvbnMudW5zaGlmdChub3RpY2UpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9Pbmx5IGRpc3BsYXkgdGhyZWUgbWVzc2FnZXNcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNlbGYubm90aWZpY2F0aW9ucy5sZW5ndGggPiAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpZmljYXRpb25zLnBvcCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoIW5vdGljZS5yZWFkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5ub3RpY2VDb3VudCsrO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9KTsgICBcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuZ2V0Tm90aWZpY2F0aW9uQ291bnQoKTtcbiAgICAgICAgXG4gICAgfVxuXG4gICAgbmdPbkRlc3Ryb3koKSB7XG4gICAgICAgIHRoaXMuc29ja2V0LnVuc3luY0J5SWQoJ25vdGlmaWNhdGlvbicsIHRoaXMuY3VycmVudFVzZXIuX2lkKTtcbiAgICB9XG59Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
